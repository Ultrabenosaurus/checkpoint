/*! checkpoint.js - v0.1.0 - 2015-08-02
* https://github.com/Ultrabenosaurus/checkpoint
* Copyright (c) 2015 Dan Bennett; Licensed BSD-3-Clause */
function chSizer(a){this.config=a}function chFinder(a){this.config=a}function chCalculator(a){this.config=a}function chPainter(a){this.config=a,this.b="undefined"!=typeof document.body?document.body:document.getElementsByTagName("body")[0],this.c}function chScroller(a){this.config=a,this.prevPos=0}function cp(a){this.config=a,this.sizer,this.finder,this.calculator,this.painter,this.scroller,this.init()}chSizer.prototype.findBrowserHeight=function(){return h=!1,"undefined"!=typeof window.innerHeight?h=window.innerHeight:"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientHeight&&0!=document.documentElement.clientHeight?h=document.documentElement.clientHeight:h=document.getElementsByTagName("body")[0].clientHeight,h},chSizer.prototype.findPageHeight=function(){return h=!1,"undefined"!=typeof document.body&&void 0!=typeof document.body.scrollHeight?h=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight):(b=document.getElementsByTagName("body")[0],d=document.getElementsByTagName("html")[0],h=Math.max(b.scrollHeight,d.scrollHeight)),h},chSizer.prototype.hasResized=function(){return checkpoint.config.browserHeight!=this.findBrowserHeight()||checkpoint.config.pageHeight!=this.findPageHeight()?(checkpoint.config.browserHeight=this.findBrowserHeight(),checkpoint.config.pageHeight=this.findPageHeight(),!0):!1},chFinder.prototype.findHeaders=function(a){return"undefined"!=typeof this.config.useClass&&this.config.useClass&&(a="."+a),document.querySelectorAll(a)},chFinder.prototype.findHeaderOffsets=function(a){h=[];for(var b=a.length-1;b>=0;b--)h[b]=[],h[b][0]=a[b].offsetTop,"undefined"!=typeof this.config.markerClickable&&this.config.markerClickable&&(hid="ch"+this.random(),a[b].id=hid,h[b][1]=hid);return h},chFinder.prototype.findAllOffsets=function(){patts=this.config.headers,offs={};for(pattern in patts)patts.hasOwnProperty(pattern)&&(f=this.findHeaders(pattern),offs[pattern]=this.findHeaderOffsets(f));return offs},chFinder.prototype.random=function(){return Math.floor(888889*Math.random())+111111},chCalculator.prototype.calcModifier=function(){return this.config.browserHeight/this.config.pageHeight},chCalculator.prototype.calcMarkerPos=function(a){m=[];for(var b=a.length-1;b>=0;b--)m[b]=Math.ceil(a[b][0]*this.config.modifier);return m},chCalculator.prototype.calcAllMarkerPos=function(){offsets=this.config.offsets,marks={};for(pattern in offsets)offsets.hasOwnProperty(pattern)&&(marks[pattern]=this.calcMarkerPos(offsets[pattern]));return marks},chCalculator.prototype.calcScrollerHeight=function(){return Math.ceil(this.config.modifier*this.config.browserHeight)},chCalculator.prototype.calcScrollerPos=function(a){return Math.ceil(this.config.modifier*a)},chPainter.prototype.paintContainer=function(){return c=document.createElement("div"),c.id="chContainer",c.style.position="fixed",c.style.top=0,c.style.right=0,c.style.width=this.config.markerWidth+"px",c.style.height=this.config.browserHeight+"px",this.b.appendChild(c),this.c=c,c},chPainter.prototype.paintMarker=function(a,c,d){return m=document.createElement("a"),m.className+=" chMarker",m.style.position="absolute",m.style.backgroundColor=c,m.style.right=0,m.style.top=a+"px",m.style.width=this.config.markerWidth+"px",m.style.height=this.config.markerHeight+"px","undefined"!=typeof this.config.markerClickable&&this.config.markerClickable&&(m.style.cursor="pointer",m.setAttribute("data-checkpoint-target","#"+d[1]),m.onclick=function(){return b="undefined"!=typeof document.body?document.body:document.getElementsByTagName("body")[0],t=document.querySelectorAll(this.getAttribute("data-checkpoint-target"))[0],b.scrollTop=t.offsetTop,!1}),this.c.appendChild(m),m},chPainter.prototype.paintHeader=function(a){headers=this.config.headers,markers=this.config.markers,offsets=this.config.offsets;for(var b=markers[a].length-1;b>=0;b--)this.paintMarker(markers[a][b],headers[a],offsets[a][b])},chPainter.prototype.paintAllHeaders=function(){headers=this.config.headers;for(pattern in headers)headers.hasOwnProperty(pattern)&&this.paintHeader(pattern)},chPainter.prototype.removeMarkers=function(){markers=document.querySelectorAll(".chMarker");for(var a=markers.length-1;a>=0;a--)this.c.removeChild(markers[a])},chPainter.prototype.paintScroller=function(a){s=document.createElement("div"),s.id="chScroller",s.style.position="absolute",s.style.backgroundColor=this.config.scrollerColour,s.style.opacity="0.5",s.style.right=0,s.style.top=a+"px",s.style.width=this.config.markerWidth+"px",s.style.height=this.config.scrollerHeight+"px",s.style.zIndex="-1",this.c.appendChild(s)},chPainter.prototype.removeScroller=function(){scroller=document.querySelectorAll("#chScroller")[0],this.c.removeChild(scroller)},chScroller.prototype.hasMoved=function(){return pos=this.findPosition(),pos!=this.prevPos?(this.prevPos=pos,!0):!1},chScroller.prototype.findPosition=function(){return window.scrollY},function(a){"use strict";function b(b){l||(l=!0,f=this,h=b||a.e,m(c))}function c(){var a=0,b=g._collection[f].listeners,c=b.length;for(a;c>a;a+=1)b[a]&&b[a].call(f,h);f=void 0,l=!1}function d(){return this.initialize(),this}function e(a,b){return g.add(a,b),e}var f,g,h,i=void 0!==a.addEventListener?"addEventListener":"attachEvent",j=void 0!==a.removeEventListener?"removeEventListener":"detachEvent",k="addEventListener"!==i?"onscroll":"scroll",l=!1,m=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}}();d.prototype.initialize=function(){return this._collection={},this},d.prototype.add=function(c,d){return"function"==typeof c&&(d=c,c=a),void 0===this._collection[c]&&(this._collection[c]={listeners:[]},c[i](k,b,!1)),this._collection[c].listeners.push(d),this},d.prototype.remove=function(a,c){if(void 0==this._collection[a])return this;var d=this._collection[a].listeners,e=0,f=d.length;if(void 0!==f)for(e;f>e;e+=1)if(d[e]===c){d.splice(e,1);break}return(0===d.length||void 0===c)&&(a[j](k,b,!1),delete this._collection[a]),this},g=new d,e.remove=function(a,b){return g.remove(a,b),e},"function"==typeof a.define&&void 0!==a.define.amd?a.define("scrolling",[],function(){return e}):"undefined"!=typeof module&&void 0!==module.exports?module.exports=e:a.scrolling=e}(this),cp.prototype.init=function(){return"undefined"==typeof chSizer||"undefined"==typeof chFinder||"undefined"==typeof chCalculator||"undefined"==typeof chPainter?!1:(this.sizer=new chSizer(this.config),this.config.browserHeight=this.sizer.findBrowserHeight(),this.config.pageHeight=this.sizer.findPageHeight(),this.finder=new chFinder(this.config),this.config.offsets=this.finder.findAllOffsets(),this.calculator=new chCalculator(this.config),this.config.modifier=this.calculator.calcModifier(),this.config.scrollerHeight=this.calculator.calcScrollerHeight(),this.config.markers=this.calculator.calcAllMarkerPos(),this.painter=new chPainter(this.config),this.config.container=this.painter.paintContainer(),this.painter.paintAllHeaders(),void("undefined"!=typeof chScroller&&"undefined"!=typeof scrolling&&(this.scroller=new chScroller(this.config),this.scroller.hasMoved(),this.painter.paintScroller(this.calculator.calcScrollerPos(this.scroller.prevPos)),scrolling(window,this.updateScroller))))},cp.prototype.updateMarkers=function(){checkpoint.sizer.hasResized()&&(checkpoint.config.modifier=checkpoint.calculator.calcModifier(),checkpoint.config.browserHeight=checkpoint.sizer.findBrowserHeight(),checkpoint.config.pageHeight=checkpoint.sizer.findPageHeight(),checkpoint.config.markers=checkpoint.calculator.calcAllMarkerPos(),checkpoint.config.scrollerHeight=checkpoint.calculator.calcScrollerHeight(),checkpoint.painter.removeMarkers(),checkpoint.painter.paintAllHeaders(),checkpoint.updateScroller())},cp.prototype.updateScroller=function(){checkpoint.scroller.hasMoved()&&(checkpoint.painter.removeScroller(),checkpoint.painter.paintScroller(checkpoint.calculator.calcScrollerPos(checkpoint.scroller.prevPos)))};var checkpoint=new cp(chConfig);