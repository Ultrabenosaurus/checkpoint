/*! checkpoint.js - v0.1.0 - 2015-07-31
* https://github.com/Ultrabenosaurus/checkpoint
* Copyright (c) 2015 Dan Bennett; Licensed BSD-3-Clause */
function chSizer(a){this.config=a}function chFinder(a){this.config=a}function chCalculator(a){this.config=a}function chPainter(a){this.config=a,this.b="undefined"!=typeof document.body?document.body:document.getElementsByTagName("body")[0],this.c}function chScroller(a){this.config=a,this.prevPos=0}function chMain(a){this.config=a,this.sizer,this.finder,this.calculator,this.painter,this.scroller,this.init(),this.bindings()}var chConf={markerWidth:20,markerHeight:5,headers:{h1:"#5ebef9",h2:"#2daaf7",h3:"#0993e8",h4:"#0774b7",h5:"#055586",h6:"#033655"},scrollerColour:"#000"};chSizer.prototype.findBrowserHeight=function(){return h=!1,"undefined"!=typeof window.innerHeight?h=window.innerHeight:"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientHeight&&0!=document.documentElement.clientHeight?h=document.documentElement.clientHeight:h=document.getElementsByTagName("body")[0].clientHeight,h},chSizer.prototype.findPageHeight=function(){return h=!1,"undefined"!=typeof document.body&&void 0!=typeof document.body.scrollHeight?h=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight):(b=document.getElementsByTagName("body")[0],d=document.getElementsByTagName("html")[0],h=Math.max(b.scrollHeight,d.scrollHeight)),h},chSizer.prototype.hasResized=function(){return checkpoint.config.browserHeight!=this.findBrowserHeight()||checkpoint.config.pageHeight!=this.findPageHeight()?(checkpoint.config.browserHeight=this.findBrowserHeight(),checkpoint.config.pageHeight=this.findPageHeight(),!0):!1},chFinder.prototype.findHeaders=function(a){return document.querySelectorAll(a)},chFinder.prototype.findHeaderOffsets=function(a){h=[];for(var b=a.length-1;b>=0;b--)h[b]=a[b].offsetTop;return h},chFinder.prototype.findAllOffsets=function(){patts=this.config.headers,offs={};for(pattern in patts)patts.hasOwnProperty(pattern)&&(f=this.findHeaders(pattern),offs[pattern]=this.findHeaderOffsets(f));return offs},chCalculator.prototype.calcModifier=function(){return this.config.browserHeight/this.config.pageHeight},chCalculator.prototype.calcMarkerPos=function(a){m=[];for(var b=a.length-1;b>=0;b--)m[b]=Math.ceil(a[b]*this.config.modifier);return m},chCalculator.prototype.calcAllMarkerPos=function(){offsets=this.config.offsets,marks={};for(pattern in offsets)offsets.hasOwnProperty(pattern)&&(marks[pattern]=this.calcMarkerPos(offsets[pattern]));return marks},chCalculator.prototype.calcScrollerHeight=function(){return Math.ceil(this.config.modifier*this.config.browserHeight)},chCalculator.prototype.calcScrollerPos=function(a){return Math.ceil(this.config.modifier*a)},chPainter.prototype.paintContainer=function(){return c=document.createElement("div"),c.id="chContainer",c.style.position="fixed",c.style.top=0,c.style.right=0,c.style.width=this.config.markerWidth+"px",c.style.height=this.config.browserHeight+"px",this.b.appendChild(c),this.c=c,c},chPainter.prototype.paintMarker=function(a,b){return m=document.createElement("div"),m.className+=" chMarker",m.style.position="absolute",m.style.backgroundColor=b,m.style.right=0,m.style.top=a+"px",m.style.width=this.config.markerWidth+"px",m.style.height=this.config.markerHeight+"px",this.c.appendChild(m),m},chPainter.prototype.paintHeader=function(a){headers=this.config.headers,markers=this.config.markers;for(var b=markers[a].length-1;b>=0;b--)this.paintMarker(markers[a][b],headers[a])},chPainter.prototype.paintAllHeaders=function(){headers=this.config.headers;for(pattern in headers)headers.hasOwnProperty(pattern)&&this.paintHeader(pattern)},chPainter.prototype.removeMarkers=function(){markers=document.querySelectorAll(".chMarker");for(var a=markers.length-1;a>=0;a--)this.c.removeChild(markers[a])},chPainter.prototype.paintScroller=function(a){s=document.createElement("div"),s.id="chScroller",s.style.position="absolute",s.style.backgroundColor=this.config.scrollerColour,s.style.opacity="0.5",s.style.right=0,s.style.top=a+"px",s.style.width=this.config.markerWidth+"px",s.style.height=this.config.scrollerHeight+"px",s.style.zIndex="-1",this.c.appendChild(s)},chPainter.prototype.removeScroller=function(){scroller=document.querySelectorAll("#chScroller")[0],this.c.removeChild(scroller)},chScroller.prototype.hasMoved=function(){return pos=this.findPosition(),pos!=this.prevPos?(this.prevPos=pos,!0):!1},chScroller.prototype.findPosition=function(){return window.scrollY},chMain.prototype.init=function(){this.sizer=new chSizer(this.config),this.config.browserHeight=this.sizer.findBrowserHeight(),this.config.pageHeight=this.sizer.findPageHeight(),this.finder=new chFinder(this.config),this.config.offsets=this.finder.findAllOffsets(),this.calculator=new chCalculator(this.config),this.config.modifier=this.calculator.calcModifier(),this.config.scrollerHeight=this.calculator.calcScrollerHeight(),this.config.markers=this.calculator.calcAllMarkerPos(),this.painter=new chPainter(this.config),this.config.container=this.painter.paintContainer(),this.painter.paintAllHeaders(),this.scroller=new chScroller(this.config),this.scroller.hasMoved(),this.painter.paintScroller(this.calculator.calcScrollerPos(this.scroller.prevPos))},chMain.prototype.bindings=function(){},chMain.prototype.updateMarkers=function(){this.sizer.hasResized()&&(this.config.modifier=this.calculator.calcModifier(),this.config.browserHeight=this.sizer.findBrowserHeight(),this.config.pageHeight=this.sizer.findPageHeight(),this.config.markers=this.calculator.calcAllMarkerPos(),this.config.scrollerHeight=this.calculator.calcScrollerHeight(),this.painter.removeMarkers(),this.painter.removeScroller(),this.painter.paintAllHeaders(),this.painter.paintScroller(this.calculator.calcScrollerPos(this.scroller.prevPos)))},chMain.prototype.updateScroller=function(){this.scroller.hasMoved()&&(this.painter.removeScroller(),this.painter.paintScroller(this.calculator.calcScrollerPos(this.scroller.prevPos)))};var checkpoint=new chMain(chConf);